<html>
<head>
  <title>Schampignon</title>
  <script src="jsparse.js" type="text/javascript"></script>
  <script src="schampignon.js" type="text/javascript"></script>
</head>
<body>
  <div id="output">
  </div>
  <form id="evalform" onsubmit="return do_eval()">
    <input type="text" name="input">
    <input type="submit" value="eval">
  </form>
  <script type="text/javascript">
var ground_env = new Scm_env();
scm_just_update(ground_env, "$define!", new Scm_define());
scm_just_update(ground_env, "$vau", new Scm_vau());
scm_just_update(ground_env, "eval", new Scm_eval());
scm_just_update(ground_env, "%inert", {});

var vm = new Scm_vm(new Scm_env(ground_env));

function do_eval()
{
  var forms = scm_parse(document.forms.evalform.input.value);
  do_print(document.forms.evalform.input.value);
  for (var i = 0; i < forms.length; i++) {
    var result;
    try {
      result = scm_eval(vm, forms[i]);
    } catch(e) {
      result = "ERROR: " + e;
    }
    do_print(result);
  }
  return false;
}

function do_print(string)
{
    var resultDiv = document.createElement("div");
    resultDiv.appendChild(document.createTextNode(string));
    document.getElementById("output").appendChild(resultDiv);
    document.forms.evalform.input.value = "";
    return false;
}
  </script>
<p>Some sample code for playing
<pre>
($define! list (wrap ($vau x %ignore x)))

($define! get-current-environment (wrap ($vau %ignore e e)))

($define! $seq2 
   ($vau list-of-two env
      ((wrap ($vau %ignore %ignore (eval (car (cdr list-of-two)) env)))
       (eval (car list-of-two) env))))

($define! $sequence
   ((wrap ($vau $seq2* %ignore
             ((car $seq2*)
                ($define! $aux
                   ($vau (head . tail) env
                      ($if (null? tail)
                           (eval head env)
                           ((car $seq2*)
                              (eval head env)
                              (eval (cons $aux tail) env)))))
                ($vau body env
                   ($if (null? body)
                        %inert
                        (eval (cons $aux body) env))))))

      ($vau first-second* env
         ((wrap ($vau %ignore %ignore (eval (car (cdr first-second*)) env)))
          (eval (car first-second*) env)))))

</pre>
</body>
</html>
